<HTML>
 <head>
  <title>JUpload - File Upload Applet</title>
 </head>
 <body>
<H1>How to customize this applet ?</H1>
<H2>Content of this page</H2>
<DIR>
	<LI><A href="#MainChoices">Main Choices</A>
	<LI><A href="#HTMLConfiguration">Basic HTML configuration</A>
	<LI><A href="#ExistingUploadPolicy">Using another existing UploadPolicy</A>
	<LI><A href="#NewUploadPolicy">Creating a new UploadPolicy</A>
	<LI><A href="#parameters">List of available parameters</A>
	<LI><A href="#links">Links</A>
</DIR>

<A name="MainChoices"><H2>Main choices</H2></A>
You can customize the behavour of this applet by using one (or more) of the following ways (from the simplest to the more complex):
<UL>
	<LI><U>Basic HTML Customization</U>. Simply precise other applet parameters to the applet, in the HTML APPLET tag: 
	copy the sample given in the <A HREF="applet-basic.html">basic</A> demo. The parameters for all available upload 
	policies are displayed on the API page for UploadPolicy.
	<LI><U>Using another available upload policy</U>. You can precise another policy amongst the available ones, 
	by specifying a <I>uploadPolicy</I> parameter, like in the 
	<A HREF="applet-basic-picture.html">basic picture mode</A> demo. 
	<LI><U>Creating a new UploadPolicy, inheriting from an existing uploadpolicy</U>, like 
	DefaultUploadPolicy or PictureUploadPolicy. Then, you get a default behaviour, and only define what is specific to you.
	<LI><U>Creating an entirely new UploadPolicy</U>. More complex: you need to code again every method. This 
	also won't may not compatible with future JUploac release, which could add methods to the UploadPolicy 
	interface, that you would then have to add to your upload policy.
	<LI><U>Change code everywhere</U> ... like I did    ;-) 
</UL> 


<A name="HTMLConfiguration"><H2>Basic HTML Customization</H2></A>

A first level of customization is available by using the DefaultUploadPolicy (that is, not provide any uploadPolicy applet
parameter), and use parameters available within the DefaultUploadPolicy, without any Java coding: these
parameters are provided in HTML, within the APPLET tag that creates this applet. These parameters are described
<a href="#parameters">below</a>. As there is no uploadPolicy parameter, you can only use the parameters that are implemented
in the DefaultUploadPolicy. See the column 'Implemented in' in the parameter list, <a href="#parameters">hereafter</a>.
<BR>The main customizations available by applet parameters are listed here: 
<DIR>
	<LI> Control of the target URL (where files should be uploaded).
	<LI> Choose of an upload policy, among the available policies (see all classes that inherit from DefaultUploadPolicy
	<LI> Log information level, with debugLevel.
	<LI> Language control, that can be specific for the HTML page.
	<LI> A URL where all debug information can/should be sent when an error occurs (see urlToSendErrorTo).
	<LI> Number of files to be put in one HTTP Request (see nbFilesPerRequest)
	<LI> A string to control that upload is a success (see stringUploadSuccess)
	<LI> For pictures only: A maximum width and/or height (see maxPicHeight and maxPicWidth)
</DIR> 

<A NAME="ExistingUploadPolicy"><H2>Using another existing UploadPolicy</H2></A>

<P>By providing the <I>uploadPolicy</I> parameter within the APPLET tag, you can select another class that implements
the UploadPolicy interface. 
<A NAME="policies">The current implemented upload policies are :</A>
<DIR>
<LI><B>DefaultUploadPolicy</B>. It's a 'simple' instanciation of each UploadPolicy methods. 
It makes JUpload work the same way as the original JUpload (v1).
<LI><B><I>(deprecated)</I> CustomizedNbFilesPerRequestUploadPolicy</B> is a DefaultUploadPolicy, which allows 
to control how many files are to be uploaded for each HTTP request. This class is now of no use, as the 
<I>nbFilesPerRequest</I> is now managed directly by the DefaultUploadPolicy.
<LI><B>FileByFileUploadPolicy</B> is CustomizedNbFilesPerRequestUploadPolicy, where the
number of files to upload for each HTTP request is ... one! This policy behaves as the DefaultUploadPolicy, when
nbFilesPerRequest parameter (see below) is 1.
<LI><B>PictureUploadPolicy</B> adds picture handling the the applet. The main 
functionnalities are :
		<DIR>
			<LI> Filter: only picture files can be uploaded.
			<LI> Preview picture: The look of the applet changes, to allow display of the selected picture.
			<LI> Rotation: you can rotate the picture by quarter of turn.
			<LI> Resizing: the applet can resize picture before upload, to lower network (and time) transfert. Just 
				specify a maximum width and/or height, in pixels. 
		</DIR>
<LI><B>CoppermineUploadPolicy</B> is a special PictureUploadPolicy: it allows upload
to the nice <a href="http://coppermine.sourceforge.net">coppermine picture gallery</a>. Its main add is to manage 
the albumId, so that uploaded pictures are directly uploaded into the selected album, and to change the current
navigator page to the album property page, so that the user can change comments for all uploaded pictures in one step.
</DIR>


<A NAME="NewUploadPolicy"><H2>Customization by creating a new Java Upload Policy (simple java coding)</H2></A>

<H3>Presentation</H3>

<P>If these customization possibilities are not enough, you can create a new upload policy. To do this, you need to 
create a new java class: the easiest way is to inherit from DefaultUploadPolicy. You can then override 
methods of the UploadPolicy interface. </P>
<P>This kind of customization will be compatible within next JUpload applet release. If you need other hooks (method
within the UploadPolicy interface, to allow other customizations), please let me know by 
<a href="mailto:etienne_sf@sourceforge.net">sending me a mail</a>, or post a new Feature Request in the jupload sourceforge 
project page.</P>
<P>Here is a description of the customization that you can do by using the creating a new policy, using the 
UploadPolicy interface:
<DIR>
	<LI> Control files management:
	   <DIR>
		  <LI> Authorization (or not) to add a file to the list of files to upload, see UploadPolicy.createFileData(File). 
		  This allows the policy to validate files, before adding them to the list of files that must be displayed. The
		  PictureUploadPolicy.createFileData(File) checks that the added files are valid pictures. 
		  <LI> File preparation before upload (for instance to resize a picture, or encode a text file to a specific format)
	   </DIR>
	<LI>Display other buttons on the applet (or remove the default buttons), see UploadPolicy.createTopPanel(JButton, JButton, JButton, JPanel)
	<LI>Specific behaviour, on file selection. The wjhk.jupload2.policies.PictureUploadPolicy allows picture 
	management. The UploadPolicy.onSelectFile(FileData) method is called when the user selects a file in the list. This allow
	the policy to do any action about this file. The PictureUploadPolicy.onSelectFile(FileData) displays a 
	preview pictures on the top part of the applet.  
</DIR>

<H3>Note: UploadPolicyFactory</H3>

<P>From the application, the UploadPolicyFactory allows easy instanciation of the needed UploadPolicy. That is </P>
<DIR>
	<LI>During intialization of the applet, the UploadPolicyFactory.getUploadPolicy() method is called. This method
	checks the <I>uploadPolicy</I> parameter. If this uploadPolicy is unknown, the DefaultUploadPolicy is used. If
	a specific uploadPolicy is found, it can read specific parameters.
	<LI>Then, UploadPolicyFactory.getUploadPolicy() creates the class implementing the UploadPolicy factory, and 
	returns the reference to this class.
	<LI>The upload policy can not be changed while the applet is running.
</DIR>

<H3>Creation of a new UploadPolicy: detailed steps</H3>
<P>To create a new UploadPolicy, you'll need to:</P>
<DIR
	<LI><B>Create a new class, implementing the UploadPolicy interface</B>. The easiest way is to inherit from an
	existing UploadPolicy. This insure that your new policy will be compatible with next JUpload releases.
	<BR><I>Note: The upload policies are created by UploadPolicyFactory. So their constructor must be available to
	this class. All upload polices available in the JUpload package have protected constructors, to be sure that 
	only the UploadPolicyFactory create these classes.</I> 
	<LI><B>Override some UploadPolicy methods</B>, to have your specific behaviour.
	<LI><B>Update the UploadPolicyFactory.getUploadPolicy()</B>, to allow it to create your new UploadPolicy.
	<BR><I>Note: I'll try to make things be more dynamic, so that updating this method is no more necessary. This could
	be done by providing a </I>uploadPolicy<I> with the full class name with its package.</I>
	<LI>Don't change any other java code, so that your upload policy will work with next JUpload releases.
	<BR><I>Note: if you need another 'hook', to be able to add specific customization, please add a new Feature Request
	in sourceforge, and/or <a href="mailto:etienne_sf@sourceforge.net">sending me a mail</a></I>
</DIR>


<A NAME="parameters"><H2>Parameters</H2></A>

Here is the list of all parameters available in the current package. These are applet parameters that should be 
'given' to the applet, with <PARAM> tags, as precised below in the <A href="#example">example</A>.
<BR>
<I>Note: please check the UploadPolicy API page, to have the real up-to-date list of parameters.</I>
<TABLE border=1>
<TR>
  <TH>Parameter name</TH>
  <TH>Default value / <BR> Implemented in</TH>
  <TH>Description</TH>
</TR>
<TR>
  <TD>uploadPolicy</TD>
  <TD>DefaultUploadPolicy <BR><BR> see UploadPolicyFactory</TD>
  <TD>This parameter contains the class name for the UploadPolicy that should be used. If it is not 
      set, or if its value is unknown from UploadPolicyFactory.getUploadPolicy(Applet, JTextArea, String),
      the DefaultUploadPolicy is used.
  </TD>
</TR>
<TR>
  <TD>postURL</TD>
  <TD><I>Mandatory</I> <BR><BR> DefaultUploadPolicy</TD>
  <TD>
		It contains the target URL toward which the files should be upload. This parameter is mandatory for existing class. It may
     become optional in new UploadPolicy, that would create this URL from other data.
		If the this URL may change during the applet execution time, you can create a new UploadPolicy class, 
		and either :
		<DIR>
			<LI>Override the UploadPolicy.getPostURL() method, to make the postURL totaly dynamic.  
			<LI>Override the UploadPolicy.setPostURL(String) method, to modify the postURL on the fly, when it is changed. 
			<LI>Override the UploadPolicy.setProperty(String, String) method. The 
				CoppermineUploadPolicy changes the postURL when the albumID property changes.  
			<LI>Find another solution ... 
	    </DIR> 
	 </TD>
</TR>
<TR>
  <TD>debugLevel</TD>
  <TD>0 <BR><BR> DefaultUploadPolicy</TD>
  <TD>With 0, you get the normal production output. The higher the number is, the more information is displayed
      in the status bar.
	     <BR>Note: the whole debug messages is stored in the DefaultUploadPolicy.debugBufferString.
      It can be used to display more information, if needed. See also the 'webmasterMail' parameter.
  </TD>
</TR>
<TR>
  <TD>lang</TD>
  <TD>Navigator language <BR><BR> DefaultUploadPolicy</TD>
  <TD>Should be something like <I>en</I>, <I>fr</I>... Currently only french and english are known 
      from the applet. If anyone want to add another language ... Please translate the
      wjhk.jupload2.lang.lang_en, and send it back <a href="mailto:etienne_sf@sourceforge.net>to me</a>.
  </TD>
</TR>
<TR>
  <TD>urlToSendErrorTo</TD>
  <TD><I>Empty String</I> <BR><BR> DefaultUploadPolicy</TD>
  <TD>If this url is given, and an upload error occurs, the applet post the all the debug output to this
    address. It's up to this URL to handle this mail. It is possible to just store the file, or to log the 
    error in a database, or to send a mail (like the mail.php script given with the coppermine pack).
  </TD>
</TR>
<TR>
  <TD>nbFilesPerRequest</TD>
  <TD>-1 <BR><BR> DefaultUploadPolicy</TD>
  <TD>This allows the control of the maximal number of files that are uploaded in one HTTP upload to the server.
       <BR>
       If set to -1, there is no maximum. This means that all files are uploaded in the same HTTP request.
       <BR>
       If set to 5, for instance, and there are 6 files to upload, there will be two HTTP upload request to the 
       server : 5 files in the first one, and that last file in a second HTTP request.   
  </TD>
</TR>
<TR>
  <TD>serverProtocol</TD>
  <TD>HTTP/1.1 <BR><BR> DefaultUploadPolicy</TD>
  <TD>This parameter allows the control of the protocol toward the server. Currently, only HTTP is supported, so 
		valid values are HTTP/0.9 (not tested), HTTP/1.0 and HTTP/1.1.
     <BR>This parameter is really useful only in CoppermineUploadPolicy, 
		as the coppermine application also controls that the requests send within an HTTP session uses the same 
     HTTP protocol (as a protection to limit the 'steal' of session cookies).  
	 </TD>
</TR>
<TR>
  <TD>stringUploadSuccess</TD>
  <TD>.* 200 OK$ <BR><BR> DefaultUploadPolicy</TD>
  <TD>This string is a regular expression. The upload thread will try to match this regular epression to each 
     lines returned from the server.
		If the match is successfull, the upload is considered to be a success. If not, a 
     {@link wjhk.jupload2.exception.JUploadExceptionUploadFailed is thrown.
    <BR>
    The default test expression testes that the web server returns no HTTP error: 200 is the return code for a 
    successfull HTTP request. It actually means that postURL is a valid URL, and that the applet was able to send 
    a request to this URL: there should be no problem with the network configuration, like proxy, password proxy...). 
    <BR>
    <B>But</B> it doesn't mean that the uploaded files have correctly be managed by the server. For instance, the
    URL can be http://sourceforge.net, which, of course, would not take your files into account.
    <BR>
    So, as soon as you know a regular expression that test the return from the target application (and not just
    a techical HTTP response code), change the stringUploadSuccess to this value. For instance, the 
    CoppermineUploadPolicy
    changes this value to "^SUCCESS$", as the HTTP body content of the server's answer contain just this exact 
    line. This 'success' means that the pictures have correctly be added to the album, that vignettes have been 
    generated (this I suppose), etc...
  </TD>
</TR>
<TR>
  <TD>maxPicHeight</TD>
  <TD>-1 <BR><BR> PictureUploadPolicy</TD>
  <TD>This parameters allows the PHP script to control the maximum height for pictures. If a picture is to be 
     download, and its height is bigger, the picture will be resized. The proportion between width and height
     of the resized picture are the same as those of the original picture. If both maxPicHeight and maxPicWidth
     are given, it can happen that the resized picture has a height lesser than maxPicHeight, so that width 
     is no more than maxPicWidth.
     <BR>
     <B>Precisions:</B>
     <BR>
     If this parameter value is negative, then no control is done on the picture height.
     <BR>
     If the original picture is smaller than the maximum size, the picture is not enlarged.
     <BR>
     If the picture is resized, its other characteristics are kept (number of colors, ColorModel...). The picture 
     format is ketp, if targetPictureFormat is empty. If the picture format is a destructive (like jpeg), the 
     maximum available quality is choosed.
  </TD>
</TR>
<TR>
  <TD>maxPicWidth</TD>
  <TD>-1 <BR><BR> PictureUploadPolicy</TD>
  <TD>Same as maxPicHeight, but for the maximum width of the uploaded picture.</TD>
</TR>
<TR>
  <TD>targetPictureFormat</TD>
  <TD><I>Empty String</I> <BR><BR>  (<B>to be</B> implemented in PictureUploadPolicy)</TD>
  <TD>This parameter can contain any picture writer known by the JVM. For instance: jpeg, png, gif. All standard 
      formats should be available. More information can be found on the  
      <A href='http://java.sun.com/j2se/1.4.2/docs/guide/imageio/spec/title.fm.html'>java.sun.com</A> web site.
  </TD>
</TR>
<TR>
  <TD>albumId</TD>
  <TD>-1 <BR><BR> CoppermineUploadPolicy</TD>
  <TD>This parameter is only used by CoppermineUploadPolicy. So it is to be used to upload into a 
      <a href="http://coppermine.sourceforge.net/">coppermine picture gallery</a>. This parameter 
      contains the identifier of the album, where pictures should be used. See CoppermineUploadPolicy 
      for an example.
  </TD>
</TR>
<TR>
  <TD>storeBufferedImage</TD>
  <TD>false <BR><BR> PictureUploadPolicy</TD>
  <TD>This parameter indicates that the preview image on the applet is kept in memory. It works really
      nice under eclise.  But, once in the navigator, the applet runs very quickly out of memory. So I add a lot
      of calls to {@link wjhk.jupload2.filedata.PictureFileData#freeMemory(String), but it doesn't change 
      anything. Be careful to this parameter, and let it to the default value, unless you've well tested it
      under all your target client configurations. 
   </TD>
</TR>
</TABLE>

<A NAME="links"></A>
  <center>
   <table width=640 cellpadding=7 cellspacing=0 border=0>
     <tr><td><font face=arial size=-1></font></td></tr>
     <tr>
     	<td>
     	</td>
     </tr>
     <tr><td>
      <table width=100% cellpadding=0 cellspacing=0 border=0>
       <tr><td colspan=3><hr size=1 noshade width=100%></td></tr>
       <tr>
        <td NOWRAP><A HREF="http://sourceforge.net/projects/jupload/">Project page</A>&nbsp;|&nbsp;
            <A HREF="index.html">Home Page (Demo)</A>&nbsp;|&nbsp;
            <A HREF="howto-customization.html">HowTo customize it</A>&nbsp;|&nbsp;
            <A HREF="README.txt">ReadMe</A>&nbsp;|&nbsp;
            <A HREF="RELEASE-NOTES.txt">Release Notes</A>
        </td>
        <td WIDTH=100%></td>
        <td><A href="http://sourceforge.net"><IMG src="images/sourceforge_logo.gif" border="0" alt="SourceForge Logo"></A></td>
       </tr>
       <tr>
        <td>
            Demo: 
              <A HREF="applet-basic.html">basic</A>,
              <A HREF="applet-basic-picture.html">picture mode</A>,
              <A HREF="advanced_js_demo.html">advanced demo</A>
            &nbsp;&nbsp;|&nbsp;Loading locally:
            <A HREF="webstart.jnlp">Web Start</A>
        </td>
       </tr>
       <tr><td colspan=3><hr size=1 noshade width=100%></td></tr>
      </table>
     </td></tr>
    </table>
  </center>
 </body>
</HTML> 	 	